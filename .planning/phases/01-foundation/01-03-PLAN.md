---
phase: 01-foundation
plan: "03"
type: execute
wave: 3
depends_on:
  - "01-02"
files_modified:
  - js/nav.js
  - js/animations.js
autonomous: false
requirements:
  - REQ-F04
  - REQ-F06

must_haves:
  truths:
    - "Opening DevTools on any page shows GSAP and ScrollTrigger loaded with no console errors"
    - "typeof gsap returns 'object' in the browser console"
    - "The nav appears on every page — editing _includes/nav.html once updates all pages"
    - "The footer appears on every page — editing _includes/footer.html once updates all pages"
    - "The current page's nav link has aria-current='page' set automatically"
    - "Pages are fully readable if JavaScript is disabled — content is not gated behind JS"
  artifacts:
    - path: "js/nav.js"
      provides: "Fetch-inject for nav and footer + active link state management"
      min_lines: 40
      contains: "injectInclude"
    - path: "js/animations.js"
      provides: "GSAP init stub — registers ScrollTrigger, no animations yet (Phase 8 populates)"
      contains: "gsap.registerPlugin"
  key_links:
    - from: "js/nav.js"
      to: "_includes/nav.html"
      via: "fetch('/_includes/nav.html') injected into #site-nav"
      pattern: "/_includes/nav\\.html"
    - from: "js/nav.js"
      to: "_includes/footer.html"
      via: "fetch('/_includes/footer.html') injected into #site-footer"
      pattern: "/_includes/footer\\.html"
    - from: "js/animations.js"
      to: "gsap (CDN)"
      via: "typeof gsap guard + gsap.registerPlugin(ScrollTrigger)"
      pattern: "registerPlugin"
---

<objective>
Write the fetch-inject nav script and GSAP init stub, then verify the full scaffold works in-browser via VS Code Live Server.

Purpose: Without nav.js, the nav and footer injection hooks (`#site-nav`, `#site-footer`) remain empty on every page. This plan wires the fetch-inject mechanism and verifies that GSAP loads correctly, completing the Phase 1 foundation.

Output: `js/nav.js` (fetch-inject with active link state), `js/animations.js` (GSAP stub), and a human-verified local preview confirming nav, footer, and GSAP all work.
</objective>

<execution_context>
@C:/Users/rebec/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rebec/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write js/nav.js (fetch-inject + active state) and js/animations.js (GSAP stub)</name>
  <files>
    js/nav.js
    js/animations.js
  </files>
  <action>
    Create two JS files in the /js/ directory. The working directory is C:/Users/rebec/Documents/Portfolio.

    **CRITICAL: fetch() fails on file:// protocol.** These scripts will not work when pages are opened by double-clicking. They require a local HTTP server. VS Code Live Server (Right-click index.html → Open with Live Server) serves on localhost:5500. The verification step uses Live Server.

    **js/nav.js — fetch-inject nav and footer, plus active link state:**

    ```javascript
    // js/nav.js
    // Injects shared nav and footer from _includes/ into every page.
    // REQUIRES local HTTP server (e.g. VS Code Live Server) — fetch() fails on file://
    //
    // To update nav links: edit _includes/nav.html — one edit updates all pages.
    // To update footer: edit _includes/footer.html — one edit updates all pages.
    //
    // Uses root-relative paths (/_includes/...) so this works from any page depth.

    (function () {
      'use strict';

      // Fetch an HTML fragment and inject it into a target element by ID.
      // Dispatches a custom event when injection is complete so other scripts can react.
      function injectInclude(targetId, includePath, eventName) {
        var el = document.getElementById(targetId);
        if (!el) return; // Target element not in page — bail silently

        fetch(includePath)
          .then(function (response) {
            if (!response.ok) {
              throw new Error('Failed to load ' + includePath + ' (' + response.status + ')');
            }
            return response.text();
          })
          .then(function (html) {
            el.innerHTML = html;
            // Signal that this include is ready (e.g. so active state can run)
            document.dispatchEvent(new CustomEvent(eventName));
          })
          .catch(function (err) {
            // Fail gracefully — page remains readable; only nav/footer appearance is affected
            console.warn('[nav.js]', err.message);
          });
      }

      // Inject nav and footer from single-source include files
      injectInclude('site-nav', '/_includes/nav.html', 'navReady');
      injectInclude('site-footer', '/_includes/footer.html', 'footerReady');

      // Set active state on nav links after nav is injected
      // Compares window.location.pathname to each link's href attribute
      // Sets aria-current="page" and class="is-active" on the matching link
      document.addEventListener('navReady', function () {
        var currentPath = window.location.pathname;
        var links = document.querySelectorAll('.site-nav__link');

        links.forEach(function (link) {
          var linkHref = link.getAttribute('href');

          // Normalize: strip trailing slash, but keep root '/' as-is
          var linkPath = linkHref.replace(/\/$/, '') || '/';
          var pagePath = currentPath.replace(/\/$/, '') || '/';

          // Exact match only — prevents /work matching /work/project-name
          if (linkPath === pagePath) {
            link.setAttribute('aria-current', 'page');
            link.classList.add('is-active');
          }
        });
      });

    })();
    ```

    **js/animations.js — GSAP init stub (Phase 8 adds actual animations):**

    ```javascript
    // js/animations.js
    // GSAP animation initialization.
    // Phase 1: stub only — registers ScrollTrigger plugin, no animations yet.
    // Phase 8: origami fold transitions are added here.
    //
    // All animation timing values live in css/tokens.css (--duration-*, --ease-*, --perspective-fold).
    // GSAP reads them via getComputedStyle() to keep CSS and JS in sync.

    (function () {
      'use strict';

      // Guard: bail if GSAP did not load (CDN failure, or JS disabled)
      // Pages must be fully readable without this script — animations are progressive enhancement.
      if (typeof gsap === 'undefined') {
        console.warn('[animations.js] GSAP not loaded — animations disabled.');
        return;
      }

      // ScrollTrigger must be registered before any ScrollTrigger usage.
      // This must happen before Phase 8 scroll-driven animations are defined.
      gsap.registerPlugin(ScrollTrigger);

      // ── Phase 8 animation code goes here ──────────────────────────────────
      // Pattern: read timing from CSS custom properties, not hardcoded values:
      //   var styles = getComputedStyle(document.documentElement);
      //   var duration = parseFloat(styles.getPropertyValue('--duration-fold')) / 1000;
      // ──────────────────────────────────────────────────────────────────────

    })();
    ```

    Both files use IIFEs (immediately-invoked function expressions) to avoid polluting the global scope. Both use 'use strict'. Both use var for ES5 compatibility across older browsers (consistent with fetch-inject pattern in research).

    After writing the files, verify they exist:
    ```bash
    ls js/nav.js js/animations.js
    ```
  </action>
  <verify>
    <automated>cd C:/Users/rebec/Documents/Portfolio && ls js/nav.js js/animations.js && grep "injectInclude" js/nav.js && grep "registerPlugin" js/animations.js && grep "/_includes/nav.html" js/nav.js</automated>
    <manual>nav.js contains injectInclude function and fetches /_includes/nav.html and /_includes/footer.html. animations.js contains gsap.registerPlugin(ScrollTrigger). Both use root-relative paths. Both use 'use strict'.</manual>
  </verify>
  <done>js/nav.js written with fetch-inject for nav and footer, active link state via navReady event, graceful failure on fetch error. js/animations.js written with GSAP guard and ScrollTrigger registration stub. Both files confirmed to exist at correct paths.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete Phase 1 scaffold in browser via Live Server</name>
  <action>Open the site via VS Code Live Server and run all 16 verification checks listed in how-to-verify. No files are written — this task confirms the prior automation produced a working scaffold.</action>
  <verify>
    <automated>MISSING — this is a human browser check; automated verification is not possible for visual/interactive checks</automated>
    <manual>See how-to-verify steps 1–16: GSAP in console, nav injection, footer injection, sub-page navigation, Earlier Work absent, browser tab titles</manual>
  </verify>
  <done>typeof gsap returns 'object' in browser console with no errors; nav and footer appear on all 5 pages; clicking Work/Writing/About/Contact returns no 404s; Earlier Work absent from nav; browser tab shows "Origami Games" on each page.</done>
  <what-built>
    Complete Phase 1 scaffold:
    - CSS design tokens and layer stubs (Plan 01-01)
    - Five HTML skeleton pages at correct URLs (Plan 01-02)
    - _includes/nav.html and _includes/footer.html single-source includes (Plan 01-02)
    - js/nav.js fetch-inject with active state (this plan)
    - js/animations.js GSAP init stub (this plan)
  </what-built>
  <how-to-verify>
    Open the site using VS Code Live Server (required — fetch() fails on file://):
    1. In VS Code, right-click index.html → "Open with Live Server"
    2. The site should open at http://localhost:5500 (or similar)

    Verify GSAP is loaded:
    3. Open browser DevTools (F12) → Console tab
    4. Type: `typeof gsap` → should return `"object"`
    5. Type: `typeof ScrollTrigger` → should return `"object"`
    6. Console should show NO errors (warnings are okay — CORS warnings from Google Fonts on localhost are expected)

    Verify nav injection:
    7. The nav should appear on the page with: Origami Games (logo) | Home | Work | Writing | About | Contact
    8. "Home" link should have a visible active state (aria-current="page" — inspect element to confirm, or check if the link appears styled differently)

    Verify footer injection:
    9. Scroll to bottom — the footer should appear with nav echo links and contact information

    Verify sub-pages work:
    10. Click "Work" in nav → should load http://localhost:5500/work/ with no 404
    11. Click "Writing" → loads /writing/ with no 404
    12. Click "About" → loads /about/ with no 404
    13. Click "Contact" → navigates to /about#contact and the page has that section
    14. Each page should show its nav (with correct active state for that page) and footer

    Verify earlier-work is hidden:
    15. Check that "Earlier Work" does NOT appear in the nav on any page

    Verify browser tab title:
    16. Each page should show "Origami Games" in the browser tab (e.g. "Work — Origami Games")
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Run from repo root (C:/Users/rebec/Documents/Portfolio):

```bash
# JS files exist
ls js/nav.js js/animations.js

# nav.js fetches from correct root-relative paths
grep "/_includes/nav.html" js/nav.js
grep "/_includes/footer.html" js/nav.js

# animations.js registers ScrollTrigger
grep "registerPlugin" js/animations.js

# GSAP guard exists
grep "typeof gsap" js/animations.js
```

Then open with VS Code Live Server and run the manual verification steps in Task 2.
</verification>

<success_criteria>
- js/nav.js fetches /_includes/nav.html into #site-nav and /_includes/footer.html into #site-footer using root-relative paths
- Active state logic sets aria-current="page" on the current page's nav link
- js/animations.js registers ScrollTrigger and bails gracefully if GSAP is undefined
- Human verification: typeof gsap returns 'object' in browser console — no errors
- Human verification: Nav and footer appear on all five pages
- Human verification: All nav links resolve to the correct pages — no 404s
- Human verification: Earlier Work not visible in nav
- Human verification: Browser tab shows "Origami Games" on each page
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
